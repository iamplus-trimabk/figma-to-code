# Stage 3: Template-Based Component Generation System

## ğŸ¯ **Vision: Jinja2-Powered Universal Component Generator**

Create a sophisticated template-based component generation system using Jinja2 that transforms Stage 2 design tokens into production-ready React components. This approach uses proven template engine technology to generate consistent, high-quality components with maximum automation and minimal manual intervention.

## ğŸ—ï¸ **Core Architecture: Template Engine + Design Token Integration**

### **How It Works:**
1. **Design Token Processing** - Extract and normalize tokens from Stage 2 outputs
2. **Template Selection** - Choose appropriate template based on component type and platform
3. **Code Generation** - Apply Jinja2 templates with design tokens to generate components
4. **Post-Processing** - Apply platform-specific adaptations and optimizations
5. **Output Generation** - Create complete component files with proper TypeScript types

## ğŸ¨ **Template System Architecture**

### **Template Hierarchy:**
```
templates/
â”œâ”€â”€ base/                           # Base templates for common patterns
â”‚   â”œâ”€â”€ component.j2               # Base component template
â”‚   â”œâ”€â”€ form-component.j2          # Base form component template
â”‚   â”œâ”€â”€ display-component.j2       # Base display component template
â”‚   â””â”€â”€ data-component.j2          # Base data component template
â”œâ”€â”€ components/                     # Component-specific templates
â”‚   â”œâ”€â”€ forms/
â”‚   â”‚   â”œâ”€â”€ input.j2              # Input component template
â”‚   â”‚   â”œâ”€â”€ select.j2             # Select component template
â”‚   â”‚   â”œâ”€â”€ checkbox.j2           # Checkbox component template
â”‚   â”‚   â”œâ”€â”€ textarea.j2           # Textarea component template
â”‚   â”‚   â””â”€â”€ form.j2               # Form container template
â”‚   â”œâ”€â”€ display/
â”‚   â”‚   â”œâ”€â”€ card.j2               # Card component template
â”‚   â”‚   â”œâ”€â”€ badge.j2              # Badge component template
â”‚   â”‚   â”œâ”€â”€ avatar.j2             # Avatar component template
â”‚   â”‚   â”œâ”€â”€ skeleton.j2           # Skeleton component template
â”‚   â”‚   â””â”€â”€ divider.j2            # Divider component template
â”‚   â”œâ”€â”€ navigation/
â”‚   â”‚   â”œâ”€â”€ button.j2             # Button component template
â”‚   â”‚   â”œâ”€â”€ tabs.j2               # Tabs component template
â”‚   â”‚   â”œâ”€â”€ pagination.j2         # Pagination component template
â”‚   â”‚   â””â”€â”€ breadcrumb.j2         # Breadcrumb component template
â”‚   â”œâ”€â”€ feedback/
â”‚   â”‚   â”œâ”€â”€ alert.j2              # Alert component template
â”‚   â”‚   â”œâ”€â”€ modal.j2              # Modal component template
â”‚   â”‚   â”œâ”€â”€ toast.j2              # Toast component template
â”‚   â”‚   â””â”€â”€ tooltip.j2            # Tooltip component template
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ table.j2              # Table component template
â”‚   â”‚   â”œâ”€â”€ list.j2               # List component template
â”‚   â”‚   â””â”€â”€ chart.j2              # Chart component template
â”‚   â””â”€â”€ blocks/
â”‚       â”œâ”€â”€ dashboard.j2          # Dashboard block template
â”‚       â”œâ”€â”€ auth-form.j2          # Authentication form template
â”‚       â””â”€â”€ settings-page.j2      # Settings page template
â”œâ”€â”€ hooks/                         # Hook templates following unified-ui patterns
â”‚   â”œâ”€â”€ use-async-data.j2         # Async data hook template
â”‚   â”œâ”€â”€ use-component-state.j2    # Component state hook template
â”‚   â””â”€â”€ use-form-state.j2         # Form state hook template
â”œâ”€â”€ types/                         # TypeScript interface templates
â”‚   â”œâ”€â”€ component-props.j2        # Component props interface template
â”‚   â”œâ”€â”€ hook-return.j2            # Hook return type template
â”‚   â””â”€â”€ entity-types.j2           # Entity type templates
â””â”€â”€ partials/                      # Reusable template fragments
    â”œâ”€â”€ imports.j2                 # Import statements
    â”œâ”€â”€ variants.j2               # CVA variant definitions
    â”œâ”€â”€ accessibility.j2          # Accessibility attributes
    â”œâ”€â”€ error-handling.j2         # Error handling patterns
    â””â”€â”€ loading-states.j2         # Loading state patterns
```

## ğŸ“ **Template Engine Implementation**

### **Base Component Template (component.j2):**
```jinja2
"""Generated by Stage 3 Component Generator"""
"use client"

import * as React from "react"
{%- if uses_shadcn %}
import { {{ shadcn_components|join(', ') } } from "@shadcn/components"
{%- endif %}
{%- if uses_hooks %}
import { {{ hooks|join(', ') } } from "@iamplus/hooks"
{%- endif %}
{%- if has_variants %}
import { cva } from "class-variance-authority"
{%- endif %}

{%- from 'partials/imports.j2' import component_imports, hook_imports %}
{{ component_imports }}

{%- from 'partials/types.j2' import component_interface %}
{{ component_interface }}

{%- from 'partials/variants.j2' import variant_definitions %}
{%- if has_variants %}
{{ variant_definitions }}

const {{ component_name }}Variants = cva(
  "{{ base_classes }}",
  {
    variants: {
      {{ variants }}
    },
    defaultVariants: {
      {{ default_variants }}
    }
  }
)
{%- endif %}

{%- from 'partials/accessibility.j2' import accessibility_props %}
{{ accessibility_props }}

export function {{ component_name }}({
  {%- for prop in props %}
  {{ prop.name }}{{ loop.last ? '' : ',' }}
  {%- endfor %}
}: {{ component_name }}Props) {
  {%- from 'partials/error-handling.j2' import error_handling %}
  {{ error_handling }}

  {%- from 'partials/loading-states.j2' import loading_state }}
  {{ loading_state }}

  {%- if uses_hooks %}
  const { data, loading, error, actions } = {{ primary_hook }}({{ hook_config }})
  {%- endif %}

  const classes = {{ component_name }}Variants({
    {%- for variant in variant_props %}
    {{ variant.name }}: {{ variant.value }},
    {%- endfor %}
    className
  })

  return (
    <div className={classes} {{ accessibility_attributes }}>
      {%- if uses_hooks %}
      {%- if shows_loading %}
      {loading_state}
      {%- endif %}
      {%- if shows_error %}
      {error_handling}
      {%- endif %}
      {%- endif %}

      <div className="{{ content_classes }}">
        {children}
      </div>
    </div>
  )
}
```

### **Input Component Template (input.j2):**
```jinja2
{%- extends "base/form-component.j2" %}

{%- block component_specific %}

{%- set props = [
  {name: 'type', type: 'string', default: '"text"', required: false},
  {name: 'placeholder', type: 'string', required: false},
  {name: 'value', type: 'string', required: false},
  {name: 'onChange', type: '(value: string) => void', required: false},
  {name: 'error', type: 'string', required: false},
  {name: 'disabled', type: 'boolean', default: 'false', required: false},
  {name: 'required', type: 'boolean', default: 'false', required: false}
] %}

{%- set variants = {
  'variant': {
    'default': 'border-gray-300 focus:border-primary focus:ring-primary',
    'error': 'border-red-500 focus:border-red-500 focus:ring-red-500',
    'success': 'border-green-500 focus:border-green-500 focus:ring-green-500'
  },
  'size': {
    'sm': 'h-8 px-2 text-sm',
    'md': 'h-10 px-3 text-sm',
    'lg': 'h-12 px-4 text-base'
  }
} %}

{%- set base_classes = "flex w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %}

{%- block component_body %}
<div className="space-y-2">
  {%- if label %}
  <label className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
    {{ label }}
    {%- if required %}
    <span className="text-red-500 ml-1">*</span>
    {%- endif %}
  </label>
  {%- endif %}

  <input
    type={type}
    className={classes}
    placeholder={placeholder}
    value={value}
    onChange={(e) => onChange?.(e.target.value)}
    disabled={disabled}
    required={required}
    aria-describedby={error ? `${id}-error` : undefined}
    aria-invalid={error ? 'true' : undefined}
  />

  {%- if error %}
  <p id={`${id}-error`} className="text-sm text-red-500">
    {error}
  </p>
  {%- endif %}

  {%- if helper_text %}
  <p className="text-sm text-muted-foreground">
    {helper_text}
  </p>
  {%- endif %}
</div>
{%- endblock %}

{%- endblock %}
```

### **Button Component Template (button.j2):**
```jinja2
{%- extends "base/component.j2" %}

{%- block component_specific %}

{%- set props = [
  {name: 'variant', type: '"default" | "destructive" | "outline" | "secondary" | "ghost" | "link"', default: '"default"'},
  {name: 'size', type: '"default" | "sm" | "lg" | "icon"', default: '"default"'},
  {name: 'asChild', type: 'boolean', default: 'false'},
  {name: 'loading', type: 'boolean', default: 'false'},
  {name: 'disabled', type: 'boolean', default: 'false'},
  {name: 'onClick', type: '() => void', required: false}
] %}

{%- set variants = {
  'variant': {
    'default': "bg-primary text-primary-foreground hover:bg-primary/90",
    'destructive': "bg-destructive text-destructive-foreground hover:bg-destructive/90",
    'outline': "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
    'secondary': "bg-secondary text-secondary-foreground hover:bg-secondary/80",
    'ghost': "hover:bg-accent hover:text-accent-foreground",
    'link': "text-primary underline-offset-4 hover:underline"
  },
  'size': {
    'default': "h-10 px-4 py-2",
    'sm': "h-9 rounded-md px-3",
    'lg': "h-11 rounded-md px-8",
    'icon': "h-10 w-10"
  }
} %}

{%- set base_classes = "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" %}

{%- block component_body %}
{%- if asChild %}
  {children}
{%- else %}
  <button
    className={classes}
    disabled={disabled || loading}
    onClick={onClick}
    {{ accessibility_attributes }}
  >
    {%- if loading %}
    <svg className="mr-2 h-4 w-4 animate-spin" viewBox="0 0 24 24">
      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
    </svg>
    {%- endif %}

    {children}
  </button>
{%- endif %}
{%- endblock %}

{%- endblock %}
```

## ğŸ”§ **Component Generation Pipeline**

### **Generation Engine Architecture:**
```python
class ComponentGenerator:
    def __init__(self, design_tokens: Dict, template_dir: str, output_dir: str):
        self.design_tokens = design_tokens
        self.template_dir = template_dir
        self.output_dir = output_dir
        self.jinja_env = self._setup_jinja_environment()

    def _setup_jinja_environment(self):
        """Configure Jinja2 environment with custom filters and functions"""
        env = jinja2.Environment(
            loader=jinja2.FileSystemLoader(self.template_dir),
            trim_blocks=True,
            lstrip_blocks=True
        )

        # Add custom filters for design token processing
        env.filters['token_value'] = self._get_token_value
        env.filters['css_class'] = self._token_to_css_class
        env.filters['tsx_type'] = self._token_to_tsx_type

        return env

    def generate_component(self, component_config: Dict) -> str:
        """Generate a single component from configuration"""
        # 1. Process component configuration
        processed_config = self._process_component_config(component_config)

        # 2. Select appropriate template
        template_path = self._select_template(processed_config)
        template = self.jinja_env.get_template(template_path)

        # 3. Apply design tokens
        token_context = self._apply_design_tokens(processed_config)

        # 4. Generate component code
        generated_code = template.render(**token_context)

        # 5. Post-process and format
        formatted_code = self._format_code(generated_code)

        return formatted_code

    def _process_component_config(self, config: Dict) -> Dict:
        """Process and normalize component configuration"""
        return {
            'component_name': self._to_pascal_case(config['name']),
            'component_type': config['type'],
            'category': config['category'],
            'platform': config.get('platform', 'web'),
            'props': self._process_props(config.get('props', [])),
            'variants': self._process_variants(config.get('variants', {})),
            'dependencies': self._process_dependencies(config.get('dependencies', [])),
            **config
        }

    def _apply_design_tokens(self, config: Dict) -> Dict:
        """Apply design tokens to component configuration"""
        context = config.copy()

        # Apply color tokens
        if 'colors' in self.design_tokens:
            context['color_tokens'] = self.design_tokens['colors']
            context['primary_color'] = self.design_tokens['colors']['primary']
            context['success_color'] = self.design_tokens['colors']['success']
            context['warning_color'] = self.design_tokens['colors']['warning']
            context['error_color'] = self.design_tokens['colors'].get('error', {})

        # Apply typography tokens
        if 'typography' in self.design_tokens:
            context['typography_tokens'] = self.design_tokens['typography']
            context['font_family'] = self.design_tokens['typography']['fontFamily']
            context['font_sizes'] = self.design_tokens['typography']['fontSize']
            context['font_weights'] = self.design_tokens['typography']['fontWeight']

        # Apply spacing tokens
        if 'spacing' in self.design_tokens:
            context['spacing_tokens'] = self.design_tokens['spacing']
            context['spacing_scale'] = self._create_spacing_scale(self.design_tokens['spacing'])

        # Apply border radius tokens
        if 'borderRadius' in self.design_tokens:
            context['border_radius_tokens'] = self.design_tokens['borderRadius']

        return context
```

### **Design Token Processor:**
```python
class DesignTokenProcessor:
    def __init__(self, stage2_outputs: Dict):
        self.mobile_tokens = stage2_outputs['mobile_config.json']
        self.web_tokens = stage2_outputs['web_config.json']
        self.component_interfaces = stage2_outputs['component_interfaces.json']

    def extract_tokens_for_component(self, component_name: str, platform: str = 'web') -> Dict:
        """Extract relevant design tokens for a specific component"""
        source_tokens = self.mobile_tokens if platform == 'mobile' else self.web_tokens

        component_config = next(
            (comp for comp in self.component_interfaces if comp['name'] == component_name),
            None
        )

        if not component_config:
            raise ValueError(f"Component {component_name} not found in interfaces")

        tokens = {
            'component_config': component_config,
            'colors': self._extract_color_tokens(source_tokens),
            'typography': self._extract_typography_tokens(source_tokens),
            'spacing': self._extract_spacing_tokens(source_tokens),
            'borderRadius': self._extract_border_radius_tokens(source_tokens),
            'effects': self._extract_effect_tokens(source_tokens)
        }

        return tokens

    def _extract_color_tokens(self, tokens: Dict) -> Dict:
        """Extract and normalize color tokens"""
        colors = {}

        if 'colorPalette' in tokens:
            palette = tokens['colorPalette']
            for color_name, color_values in palette.items():
                colors[color_name] = color_values

        return colors

    def _extract_typography_tokens(self, tokens: Dict) -> Dict:
        """Extract and normalize typography tokens"""
        typography = {}

        if 'typography' in tokens:
            typo_config = tokens['typography']
            typography['fontFamily'] = typo_config.get('fontFamily', {})
            typography['fontSize'] = typo_config.get('fontSize', {})
            typography['fontWeight'] = typo_config.get('fontWeight', {})
            typography['lineHeight'] = typo_config.get('lineHeight', {})

        return typography

    def _create_spacing_scale(self, spacing_tokens: Dict) -> Dict:
        """Create a normalized spacing scale"""
        scale = {}

        for key, value in spacing_tokens.items():
            if isinstance(value, (int, float)):
                scale[key] = value
            elif isinstance(value, str):
                # Convert string values to numbers if possible
                try:
                    scale[key] = float(value)
                except ValueError:
                    scale[key] = value

        return scale
```

## ğŸ¨ **Template Features**

### **1. Template Inheritance:**
```jinja2
{# templates/base/component.j2 #}
"""Base component template"""
import * as React from "react"

export function {{ component_name }}({{ props_string }}: {{ component_name }}Props) {
  {% block component_body %}
  {# Default implementation #}
  {% endblock %}
}

{# templates/components/navigation/button.j2 #}
{% extends "base/component.j2" %}

{% block component_body %}
{# Button-specific implementation #}
{% endblock %}
```

### **2. Conditional Feature Generation:**
```jinja2
{%- if component_config.features.accessibility %}
  {%- from 'partials/accessibility.j2' import accessibility_attrs %}
  {{ accessibility_attrs }}
{%- endif %}

{%- if component_config.features.validation %}
  {%- from 'partials/validation.j2' import validation_logic %}
  {{ validation_logic }}
{%- endif %}

{%- if component_config.features.loading_states %}
  {%- from 'partials/loading.j2' import loading_component %}
  {{ loading_component }}
{%- endif %}
```

### **3. Platform-Specific Adaptation:**
```jinja2
{%- if platform == 'web' %}
import { cn } from "@/lib/utils"
{%- elif platform == 'mobile' %}
import { cn } from "@/lib/utils-native"
{%- endif %}

{%- if platform == 'web' %}
className={cn(baseClasses, className)}
{%- elif platform == 'mobile' %}
style={[baseStyles, styles]}
{%- endif %}
```

### **4. Design Token Integration:**
```jinja2
{# Using design tokens in templates #}
const colors = {
  primary: "{{ color_tokens.primary.500 }}",
  background: "{{ color_tokens.background }}",
  text: "{{ color_tokens.text.primary }}"
}

const typography = {
  fontFamily: "{{ typography_tokens.fontFamily.Poppins | join(', ') }}",
  fontSize: {
    sm: "{{ typography_tokens.fontSize.sm }}px",
    base: "{{ typography_tokens.fontSize.base }}px",
    lg: "{{ typography_tokens.fontSize.lg }}px"
  }
}

const spacing = {
  sm: "{{ spacing_tokens['1'] }}px",
  md: "{{ spacing_tokens['2'] }}px",
  lg: "{{ spacing_tokens['4'] }}px"
}
```

## ğŸ“ **Generated File Structure**

### **Component Generation Output:**
```
generated_components/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ forms/
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ checkbox.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ display/
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ avatar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ skeleton.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ navigation/
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tabs.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ pagination.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ feedback/
â”‚   â”‚   â”‚   â”œâ”€â”€ alert.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ modal.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toast.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ data/
â”‚   â”‚       â”œâ”€â”€ table.tsx
â”‚   â”‚       â”œâ”€â”€ list.tsx
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ use-async-data.tsx
â”‚   â”‚   â”œâ”€â”€ use-component-state.tsx
â”‚   â”‚   â”œâ”€â”€ use-form-state.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ component-props.ts
â”‚   â”‚   â”œâ”€â”€ hook-types.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚   â”œâ”€â”€ design-tokens.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.js
â””â”€â”€ README.md
```

## ğŸ”„ **Generation Workflow**

### **Phase 1: Input Processing**
1. **Load Stage 2 Outputs** - Read design tokens and component interfaces
2. **Parse Component Requirements** - Extract component specifications
3. **Platform Detection** - Determine web/mobile target
4. **Dependency Analysis** - Identify required shadcn/ui components

### **Phase 2: Template Selection**
1. **Component Categorization** - Map to form/display/navigation/data category
2. **Template Matching** - Select appropriate base and component-specific templates
3. **Feature Analysis** - Determine which partials to include
4. **Token Mapping** - Map design tokens to template variables

### **Phase 3: Code Generation**
1. **Template Rendering** - Apply Jinja2 templates with context
2. **Token Substitution** - Replace placeholders with design token values
3. **Type Generation** - Generate TypeScript interfaces
4. **Import Resolution** - Generate proper import statements

### **Phase 4: Post-Processing**
1. **Code Formatting** - Apply Prettier/ESLint formatting
2. **Type Checking** - Validate TypeScript compilation
3. **Import Optimization** - Remove unused imports
4. **File Organization** - Create proper directory structure

## ğŸš€ **Advanced Features**

### **1. Template Inheritance System:**
```jinja2
{# Base templates provide common structure #}
{% extends "base/form-component.j2" %}

{# Component templates override specific blocks #}
{% block validation_logic %}
{# Custom validation implementation #}
{% endblock %}
```

### **2. Conditional Feature Generation:**
```python
# Template generation with feature flags
def generate_with_features(self, config: Dict, features: List[str]) -> str:
    context = {
        **config,
        'features': {
            'accessibility': 'accessibility' in features,
            'validation': 'validation' in features,
            'loading_states': 'loading_states' in features,
            'error_handling': 'error_handling' in features,
            'internationalization': 'i18n' in features
        }
    }
    return self.template.render(context)
```

### **3. Platform-Specific Adaptation:**
```jinja2
{# Platform-specific code generation #}
{%- if platform == 'web' %}
import { cn } from "@/lib/utils"
const baseClasses = cn(
  "flex items-center justify-center",
  className
)
{%- elif platform == 'mobile' %}
import { StyleSheet } from "react-native"
const baseStyles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center'
  }
})
{%- endif %}
```

### **4. Smart Component Composition:**
```python
def generate_composite_component(self, components: List[str]) -> str:
    """Generate a composite component from multiple base components"""
    composite_config = {
        'name': self._generate_composite_name(components),
        'components': components,
        'layout': self._determine_layout(components),
        'props': self._merge_component_props(components)
    }

    template = self.jinja_env.get_template('blocks/composite.j2')
    return template.render(composite_config)
```

## ğŸ“Š **Design Token Integration Examples**

### **Color System Integration:**
```jinja2
const colors = {
  primary: {
    50: "{{ color_tokens.primary.50 }}",
    100: "{{ color_tokens.primary.100 }}",
    500: "{{ color_tokens.primary.500 }}",
    900: "{{ color_tokens.primary.900 }}"
  },
  semantic: {
    success: "{{ color_tokens.success.500 }}",
    warning: "{{ color_tokens.warning.500 }}",
    error: "{{ color_tokens.error.500 | default('#ef4444') }}"
  }
}

const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md font-medium transition-colors",
  {
    variants: {
      variant: {
        default: "bg-primary text-white hover:bg-primary-600",
        success: "bg-semantic-success text-white hover:bg-semantic-success/90",
        outline: "border border-input bg-background hover:bg-accent"
      }
    }
  }
)
```

### **Typography System Integration:**
```jinja2
const typography = {
  fontFamily: {
    sans: "{{ typography_tokens.fontFamily.Poppins | join(', ') }}"
  },
  fontSize: {
    xs: "{{ typography_tokens.fontSize.xs }}px",
    sm: "{{ typography_tokens.fontSize.sm }}px",
    base: "{{ typography_tokens.fontSize.base }}px",
    lg: "{{ typography_tokens.fontSize.lg }}px"
  },
  lineHeight: {
    tight: "{{ typography_tokens.lineHeight.tight }}",
    normal: "{{ typography_tokens.lineHeight.normal }}",
    relaxed: "{{ typography_tokens.lineHeight.relaxed }}"
  }
}

export const textStyles = {
  h1: "text-4xl font-bold leading-tight",
  h2: "text-3xl font-semibold leading-normal",
  body: "text-base font-normal leading-normal",
  caption: "text-sm font-medium leading-relaxed"
}
```

### **Spacing System Integration:**
```jinja2
const spacing = {
  {%- for key, value in spacing_tokens.items() %}
  '{{ key }}': '{{ value }}px'{% if not loop.last %},{% endif %}
  {%- endfor %}
}

const spacingClasses = {
  p: (size: keyof typeof spacing) => ({ padding: spacing[size] }),
  m: (size: keyof typeof spacing) => ({ margin: spacing[size] }),
  px: (size: keyof typeof spacing) => ({
    paddingHorizontal: spacing[size],
    paddingVertical: spacing[size]
  })
}
```

## ğŸ“‹ **Implementation Checklist**

### **Phase 1: Foundation Setup**
- [ ] Install Jinja2 and set up template environment
- [ ] Create base template hierarchy
- [ ] Implement design token processor
- [ ] Set up component configuration schema

### **Phase 2: Core Templates**
- [ ] Create base component templates
- [ ] Implement form component templates
- [ ] Build display component templates
- [ ] Develop navigation component templates
- [ ] Create feedback component templates
- [ ] Implement data component templates

### **Phase 3: Advanced Features**
- [ ] Add template inheritance system
- [ ] Implement conditional feature generation
- [ ] Create platform-specific adaptations
- [ ] Build composite component generation

### **Phase 4: Integration & Testing**
- [ ] Integrate with Stage 2 design token outputs
- [ ] Test with all component interfaces
- [ ] Validate generated component functionality
- [ ] Optimize generation performance

### **Phase 5: Quality & Documentation**
- [ ] Add comprehensive error handling
- [ ] Create template documentation
- [ ] Implement validation system
- [ ] Build generation CLI tool

## ğŸ¯ **Success Criteria**

### **Generation Quality:**
1. **Consistent Output** - All generated components follow established patterns
2. **Type Safety** - Full TypeScript coverage with proper interfaces
3. **Design Token Compliance** - All components use Stage 2 design tokens correctly
4. **Platform Compatibility** - Generated components work on both web and mobile

### **Developer Experience:**
1. **Fast Generation** - Components generated in milliseconds
2. **Easy Customization** - Templates are easily customizable
3. **Comprehensive Coverage** - All major component categories supported
4. **Error Handling** - Clear error messages and validation

### **Integration Success:**
1. **shadcn/ui Compatibility** - Generated components work seamlessly with shadcn
2. **Build Integration** - Generated code passes all build checks
3. **IDE Support** - Generated code has proper TypeScript support
4. **Documentation** - Generated components include usage examples

This template-based approach provides maximum automation and consistency while maintaining the flexibility to adapt to different requirements and platforms. The Jinja2 template system offers powerful features for code generation while keeping the templates maintainable and extensible.